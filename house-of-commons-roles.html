<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Who Does What? ‚Äî House of Commons Roles - Hameez Iqbal</title>
    <link rel="stylesheet" href="styles/navbar.css">
    <link rel="stylesheet" href="styles/footer.css">
    <script src="js/navbar.js" defer></script>
    <script src="js/footer.js" defer></script>
    <style>
        :root {
            --primary-color: #FF6B6B;
            --accent-color: #4ECDC4;
            --warm-bg: #FFF9F4;
            --text-dark: #2D3436;
            --text-light: #636E72;
            --success-color: #51CF66;
            --warning-color: #FFD43B;
            --error-color: #FF6B6B;
        }
        html, body {
            overflow-x: hidden;
            width: 100%;
            min-height: 100vh;
        }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            line-height: 1.6;
            color: var(--text-dark);
            background: var(--warm-bg);
            overflow-y: auto;
        }
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            height: auto;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }
        .nav-links {
            display: flex;
            justify-content: center;
            gap: 2rem;
        }
        .nav-links a {
            color: var(--text-dark);
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            transition: color 0.3s ease;
            padding: 0.5rem 0;
        }
        .nav-links a:hover {
            color: var(--primary-color);
        }
        .nav-links a.active {
            color: var(--primary-color);
        }
        @media (max-width: 768px) {
            .nav-links {
                gap: 0.75rem;
            }
            .nav-links a {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem;
            }
        }
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 120px 2rem 2rem 2rem;
        }
        .header-section {
            text-align: center;
            margin-bottom: 2rem;
        }
        h1 {
            color: var(--primary-color);
            margin-bottom: 0.5rem;
            font-size: 2.5rem;
        }
        .subtitle {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }
        .framing-text {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        .framing-text p {
            color: var(--text-light);
            font-size: 0.95rem;
            line-height: 1.8;
            margin: 0.5rem 0;
        }
        .mode-toggle {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .mode-btn {
            background: white;
            border: 2px solid var(--text-light);
            padding: 0.75rem 2rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s ease;
            color: var(--text-dark);
        }
        .mode-btn.active {
            background: var(--accent-color);
            color: white;
            border-color: var(--accent-color);
        }
        .game-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .roles-column, .responsibilities-column {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        .column-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 1.5rem;
            text-align: center;
        }
        .roles-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .role-card {
            background: var(--warm-bg);
            border: 2px solid transparent;
            border-radius: 15px;
            padding: 1rem 1.5rem;
            cursor: grab;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 1rem;
            font-weight: 500;
            user-select: none;
        }
        .role-card:hover {
            transform: translateX(5px);
            border-color: var(--accent-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        .role-card.dragging {
            opacity: 0.5;
            cursor: grabbing;
        }
        .role-card.used {
            opacity: 0.4;
            cursor: not-allowed;
        }
        .role-icon {
            font-size: 1.5rem;
        }
        .role-name {
            font-size: 1rem;
        }
        .responsibilities-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .responsibility-zone {
            background: var(--warm-bg);
            border: 3px dashed var(--text-light);
            border-radius: 15px;
            padding: 1.5rem;
            min-height: 80px;
            transition: all 0.3s ease;
        }
        .responsibility-zone.drag-over {
            border-color: var(--accent-color);
            background: rgba(78, 205, 196, 0.1);
            transform: scale(1.02);
        }
        .responsibility-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 0.75rem;
            font-size: 1rem;
        }
        .responsibility-label.clickable {
            cursor: pointer;
            color: var(--accent-color);
        }
        .responsibility-label.clickable:hover {
            text-decoration: underline;
        }
        .dropped-roles {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        .dropped-role {
            background: white;
            border: 2px solid transparent;
            border-radius: 10px;
            padding: 0.5rem 1rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .dropped-role.correct {
            border-color: var(--success-color);
            background: rgba(81, 207, 102, 0.1);
        }
        .dropped-role.partial {
            border-color: var(--warning-color);
            background: rgba(255, 212, 59, 0.1);
        }
        .dropped-role.incorrect {
            border-color: var(--error-color);
            background: rgba(255, 107, 107, 0.1);
            cursor: pointer;
        }
        .remove-btn {
            background: var(--error-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        .btn {
            padding: 1rem 2.5rem;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        .btn-primary:hover {
            background: #ff5252;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.3);
        }
        .btn-secondary {
            background: var(--accent-color);
            color: white;
        }
        .btn-secondary:hover {
            background: #3db8ab;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(78, 205, 196, 0.3);
        }
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        .score-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-top: 2rem;
            text-align: center;
            display: none;
        }
        .score-section.show {
            display: block;
        }
        .score-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-dark);
        }
        .score-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--accent-color);
            margin-bottom: 0.5rem;
        }
        .score-description {
            color: var(--text-light);
            font-size: 1.1rem;
            margin-bottom: 1.5rem;
        }
        .explanation-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 3000;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .explanation-modal.show {
            display: flex;
        }
        .explanation-content {
            background: white;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-height: 80vh;
            overflow-y: auto;
        }
        .explanation-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }
        .explanation-text {
            color: var(--text-light);
            font-size: 1.1rem;
            line-height: 1.8;
            margin-bottom: 1rem;
        }
        .explanation-correct {
            background: rgba(81, 207, 102, 0.1);
            border-left: 4px solid var(--success-color);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        .explanation-misconception {
            background: rgba(255, 107, 107, 0.1);
            border-left: 4px solid var(--error-color);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        .explanation-close {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: 25px;
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            width: 100%;
            margin-top: 1rem;
        }
        .explanation-close:hover {
            background: #ff5252;
        }
        @media (max-width: 1024px) {
            .game-container {
                grid-template-columns: 1fr;
            }
        }
        @media (max-width: 768px) {
            .container {
                padding: 100px 1rem 2rem 1rem;
            }
            h1 {
                font-size: 2rem;
            }
            .roles-column, .responsibilities-column {
                padding: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <div id="navbar-placeholder"></div>
    <div class="container">
        <div class="header-section">
            <h1>üèõÔ∏è Who Does What? ‚Äî House of Commons Roles</h1>
            <p class="subtitle">Match each role to what they are primarily responsible for</p>
            <div class="framing-text">
                <p><strong>This game explores how the Canadian House of Commons functions day-to-day.</strong></p>
                <p>It focuses on roles and procedures‚Äînot political views.</p>
            </div>
            <div class="mode-toggle">
                <button class="mode-btn active" data-mode="learning">Learning Mode</button>
                <button class="mode-btn" data-mode="strict">Strict Mode</button>
            </div>
        </div>

        <div class="game-container">
            <div class="roles-column">
                <div class="column-title">Roles</div>
                <div class="roles-container" id="rolesContainer"></div>
            </div>
            <div class="responsibilities-column">
                <div class="column-title">Responsibilities</div>
                <div class="responsibilities-container" id="responsibilitiesContainer"></div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn btn-primary" id="checkBtn" onclick="checkAnswers()">Check Answers</button>
            <button class="btn btn-secondary" onclick="resetGame()">Reset</button>
            <button class="btn btn-secondary" onclick="newRound()" id="newRoundBtn" style="display: none;">New Round</button>
        </div>

        <div class="score-section" id="scoreSection">
            <div class="score-title">Parliamentary Knowledge Score</div>
            <div class="score-value" id="scoreValue">0 / 0</div>
            <div class="score-description" id="scoreDescription"></div>
        </div>
    </div>

    <div class="explanation-modal" id="explanationModal" onclick="closeExplanation(event)">
        <div class="explanation-content" onclick="event.stopPropagation()">
            <div id="explanationContent"></div>
            <button class="explanation-close" onclick="closeExplanation()">Got it</button>
        </div>
    </div>

    <div id="footer"></div>

    <script>
        // Roles data model
        const rolesData = [
            {
                role: "Speaker of the House",
                icon: "üéôÔ∏è",
                primary_responsibilities: [
                    "Maintains order and decorum",
                    "Enforces Standing Orders",
                    "Represents the Crown in the chamber",
                    "Rules on points of order",
                    "Oversees voting procedure"
                ],
                secondary_responsibilities: [
                    "Advises on parliamentary procedure"
                ],
                description: "A non-partisan officer elected by MPs to preside over debates and enforce parliamentary rules."
            },
            {
                role: "Prime Minister",
                icon: "üëî",
                primary_responsibilities: [
                    "Leads the government",
                    "Coordinates government policy",
                    "Represents Canada internationally"
                ],
                secondary_responsibilities: [
                    "Introduces government legislation (indirect)"
                ],
                description: "The head of government who leads the Cabinet and sets the government's agenda."
            },
            {
                role: "Leader of the Official Opposition",
                icon: "üéØ",
                primary_responsibilities: [
                    "Leads the opposition",
                    "Holds government to account",
                    "Develops alternative policy",
                    "Critiques government actions"
                ],
                secondary_responsibilities: [],
                description: "The leader of the largest opposition party who provides alternative perspectives to government policy."
            },
            {
                role: "Government House Leader",
                icon: "üìÖ",
                primary_responsibilities: [
                    "Manages House scheduling",
                    "Determines daily agenda",
                    "Negotiates debate timing",
                    "Coordinates legislative timetable"
                ],
                secondary_responsibilities: [],
                description: "Responsible for managing the government's legislative agenda and House business."
            },
            {
                role: "Opposition House Leader",
                icon: "üìã",
                primary_responsibilities: [
                    "Negotiates debate timing",
                    "Coordinates opposition strategy"
                ],
                secondary_responsibilities: [
                    "Manages House scheduling (partial)"
                ],
                description: "Works with the Government House Leader to negotiate scheduling and debate timing."
            },
            {
                role: "Government Whip",
                icon: "üì¢",
                primary_responsibilities: [
                    "Assigns MPs to committees",
                    "Ensures party attendance for votes",
                    "Communicates party strategy",
                    "Coordinates caucus discipline"
                ],
                secondary_responsibilities: [],
                description: "Ensures government MPs attend votes and follow party strategy."
            },
            {
                role: "Opposition Whip",
                icon: "üì£",
                primary_responsibilities: [
                    "Assigns MPs to committees",
                    "Ensures party attendance for votes",
                    "Communicates party strategy",
                    "Coordinates caucus discipline"
                ],
                secondary_responsibilities: [],
                description: "Ensures opposition MPs attend votes and follow party strategy."
            },
            {
                role: "Minister",
                icon: "üíº",
                primary_responsibilities: [
                    "Introduces government legislation",
                    "Defends government policy",
                    "Manages government departments"
                ],
                secondary_responsibilities: [],
                description: "Cabinet ministers responsible for specific portfolios who introduce and defend government legislation."
            },
            {
                role: "Shadow Minister",
                icon: "üîç",
                primary_responsibilities: [
                    "Critiques government actions",
                    "Develops alternative policy",
                    "Holds government to account"
                ],
                secondary_responsibilities: [],
                description: "Opposition MPs who shadow specific ministers and critique government policy in those areas."
            },
            {
                role: "Parliamentary Secretary",
                icon: "üìù",
                primary_responsibilities: [
                    "Assists ministers",
                    "Represents government in debates"
                ],
                secondary_responsibilities: [
                    "Defends government policy"
                ],
                description: "MPs who assist ministers and represent the government in parliamentary debates."
            },
            {
                role: "Backbench MP",
                icon: "üó≥Ô∏è",
                primary_responsibilities: [
                    "Represents constituents",
                    "Speaks in debates",
                    "Introduces private members' bills",
                    "Serves on committees"
                ],
                secondary_responsibilities: [],
                description: "MPs who are not in Cabinet or leadership positions, representing their constituents and participating in debates."
            },
            {
                role: "Clerk of the House",
                icon: "üìö",
                primary_responsibilities: [
                    "Advises on parliamentary procedure",
                    "Maintains official records",
                    "Protects parliamentary symbols"
                ],
                secondary_responsibilities: [],
                description: "The chief procedural advisor to the House who maintains records and advises on parliamentary procedure."
            },
            {
                role: "Sergeant-at-Arms",
                icon: "üõ°Ô∏è",
                primary_responsibilities: [
                    "Protects parliamentary symbols",
                    "Maintains security"
                ],
                secondary_responsibilities: [],
                description: "Responsible for security and ceremonial duties, including protecting the Mace."
            }
        ];

        // Responsibilities bank
        const responsibilitiesBank = [
            "Maintains order and decorum",
            "Enforces Standing Orders",
            "Represents the Crown in the chamber",
            "Rules on points of order",
            "Oversees voting procedure",
            "Manages House scheduling",
            "Determines daily agenda",
            "Negotiates debate timing",
            "Coordinates legislative timetable",
            "Assigns MPs to committees",
            "Ensures party attendance for votes",
            "Communicates party strategy",
            "Coordinates caucus discipline",
            "Advises on parliamentary procedure",
            "Maintains official records",
            "Protects parliamentary symbols",
            "Introduces government legislation",
            "Defends government policy",
            "Critiques government actions",
            "Develops alternative policy",
            "Represents constituents",
            "Speaks in debates",
            "Introduces private members' bills",
            "Serves on committees",
            "Leads the government",
            "Coordinates government policy",
            "Represents Canada internationally",
            "Leads the opposition",
            "Holds government to account",
            "Assists ministers",
            "Represents government in debates",
            "Manages government departments",
            "Maintains security"
        ];

        let currentRound = {
            roles: [],
            responsibilities: []
        };
        let gameMode = "learning";
        let answersChecked = false;
        let roleAssignments = {}; // responsibility -> [roles]

        function newRound() {
            answersChecked = false;
            roleAssignments = {};
            
            // Select 10-12 responsibilities with balanced distribution
            const shuffled = [...responsibilitiesBank].sort(() => Math.random() - 0.5);
            currentRound.responsibilities = shuffled.slice(0, 12);
            
            // Select 10-12 roles
            const shuffledRoles = [...rolesData].sort(() => Math.random() - 0.5);
            currentRound.roles = shuffledRoles.slice(0, 12);
            
            // Initialize assignments
            currentRound.responsibilities.forEach(resp => {
                roleAssignments[resp] = [];
            });
            
            renderGame();
            document.getElementById('scoreSection').classList.remove('show');
            document.getElementById('checkBtn').style.display = 'block';
            document.getElementById('checkBtn').textContent = 'Check Answers';
            document.getElementById('newRoundBtn').style.display = 'none';
        }

        function renderGame() {
            // Render roles
            const rolesContainer = document.getElementById('rolesContainer');
            rolesContainer.innerHTML = '';
            
            currentRound.roles.forEach(role => {
                const card = document.createElement('div');
                card.className = 'role-card';
                // Allow dragging if not checked, or if checked but there are incorrect answers
                card.draggable = !answersChecked || hasIncorrect();
                card.dataset.role = role.role;
                card.innerHTML = `
                    <span class="role-icon">${role.icon}</span>
                    <span class="role-name">${role.role}</span>
                `;
                
                if (!answersChecked || hasIncorrect()) {
                    card.addEventListener('dragstart', handleDragStart);
                    card.addEventListener('dragend', handleDragEnd);
                }
                
                rolesContainer.appendChild(card);
            });
            
            // Render responsibilities
            const respContainer = document.getElementById('responsibilitiesContainer');
            respContainer.innerHTML = '';
            
            currentRound.responsibilities.forEach(resp => {
                const zone = document.createElement('div');
                zone.className = 'responsibility-zone';
                zone.dataset.responsibility = resp;
                
                const label = document.createElement('div');
                label.className = 'responsibility-label' + (answersChecked ? ' clickable' : '');
                label.textContent = resp;
                if (answersChecked) {
                    label.onclick = () => showExplanation(resp);
                }
                
                const droppedRoles = document.createElement('div');
                droppedRoles.className = 'dropped-roles';
                droppedRoles.id = `dropped-${resp.replace(/\s+/g, '-')}`;
                
                zone.appendChild(label);
                zone.appendChild(droppedRoles);
                
                // Always allow dropping if there are incorrect answers
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
                
                respContainer.appendChild(zone);
                
                // Render already dropped roles
                if (roleAssignments[resp]) {
                    roleAssignments[resp].forEach(roleName => {
                        addRoleToZone(resp, roleName);
                    });
                }
            });
        }

        function handleDragStart(e) {
            e.dataTransfer.effectAllowed = 'move';
            e.dataTransfer.setData('role', e.target.dataset.role);
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const roleName = e.dataTransfer.getData('role');
            const responsibility = e.currentTarget.dataset.responsibility;
            
            // Add role to this responsibility
            if (!roleAssignments[responsibility]) {
                roleAssignments[responsibility] = [];
            }
            
            // Don't add duplicates
            if (!roleAssignments[responsibility].includes(roleName)) {
                roleAssignments[responsibility].push(roleName);
                addRoleToZone(responsibility, roleName);
            }
        }

        function addRoleToZone(responsibility, roleName) {
            const zoneId = `dropped-${responsibility.replace(/\s+/g, '-')}`;
            const container = document.getElementById(zoneId);
            
            const roleBadge = document.createElement('div');
            roleBadge.className = 'dropped-role';
            roleBadge.dataset.role = roleName;
            roleBadge.dataset.responsibility = responsibility;
            
            const role = rolesData.find(r => r.role === roleName);
            roleBadge.innerHTML = `
                <span>${role.icon} ${roleName}</span>
                ${!answersChecked ? `<button class="remove-btn" onclick="removeRole('${responsibility}', '${roleName}')">√ó</button>` : ''}
            `;
            
            container.appendChild(roleBadge);
        }

        function removeRole(responsibility, roleName) {
            if (roleAssignments[responsibility]) {
                roleAssignments[responsibility] = roleAssignments[responsibility].filter(r => r !== roleName);
            }
            renderGame();
        }

        function checkAnswers() {
            if (answersChecked && !hasIncorrect()) return;
            
            answersChecked = true;
            let correct = 0;
            let partial = 0;
            let incorrect = 0;
            let total = 0;
            
            currentRound.responsibilities.forEach(resp => {
                const assignedRoles = roleAssignments[resp] || [];
                if (assignedRoles.length === 0) return;
                
                // Find correct roles for this responsibility
                const correctRoles = [];
                const partialRoles = [];
                
                rolesData.forEach(role => {
                    if (role.primary_responsibilities.includes(resp)) {
                        correctRoles.push(role.role);
                    } else if (role.secondary_responsibilities.includes(resp)) {
                        partialRoles.push(role.role);
                    }
                });
                
                assignedRoles.forEach(roleName => {
                    total++;
                    if (correctRoles.includes(roleName)) {
                        correct++;
                    } else if (partialRoles.includes(roleName) && gameMode === "learning") {
                        partial++;
                    } else {
                        incorrect++;
                    }
                });
            });
            
            // Update visual feedback
            currentRound.responsibilities.forEach(resp => {
                const assignedRoles = roleAssignments[resp] || [];
                const correctRoles = [];
                const partialRoles = [];
                
                rolesData.forEach(role => {
                    if (role.primary_responsibilities.includes(resp)) {
                        correctRoles.push(role.role);
                    } else if (role.secondary_responsibilities.includes(resp)) {
                        partialRoles.push(role.role);
                    }
                });
                
                assignedRoles.forEach(roleName => {
                    const badge = document.querySelector(`[data-role="${roleName}"][data-responsibility="${resp}"]`);
                    if (badge) {
                        if (correctRoles.includes(roleName)) {
                            badge.classList.add('correct');
                        } else if (partialRoles.includes(roleName) && gameMode === "learning") {
                            badge.classList.add('partial');
                        } else {
                            badge.classList.add('incorrect');
                            badge.style.cursor = 'pointer';
                            badge.onclick = () => showRoleExplanation(roleName, resp);
                            // Add remove button for incorrect roles
                            const removeBtn = document.createElement('button');
                            removeBtn.className = 'remove-btn';
                            removeBtn.textContent = '√ó';
                            removeBtn.onclick = (e) => {
                                e.stopPropagation();
                                removeRole(resp, roleName);
                                // Re-check after removal
                                setTimeout(() => {
                                    answersChecked = false;
                                    checkAnswers();
                                }, 100);
                            };
                            badge.appendChild(removeBtn);
                        }
                    }
                });
            });
            
            // Calculate score
            const totalScore = gameMode === "strict" ? correct : correct + Math.floor(partial / 2);
            
            // Show score
            document.getElementById('scoreValue').textContent = `${totalScore} / ${total}`;
            document.getElementById('scoreDescription').textContent = 
                `You correctly matched ${correct} role-responsibility pairs${partial > 0 ? `, with ${partial} partially correct` : ''}.`;
            
            document.getElementById('scoreSection').classList.add('show');
            
            if (incorrect > 0) {
                document.getElementById('checkBtn').style.display = 'block';
                document.getElementById('checkBtn').textContent = 'Check Again';
                document.getElementById('newRoundBtn').style.display = 'none';
            } else {
                document.getElementById('checkBtn').style.display = 'none';
                document.getElementById('newRoundBtn').style.display = 'block';
            }
            
            // Re-render to update clickable labels
            renderGame();
        }

        function hasIncorrect() {
            if (!answersChecked) return false;
            return document.querySelectorAll('.dropped-role.incorrect').length > 0;
        }

        function showExplanation(responsibility) {
            const correctRoles = [];
            const partialRoles = [];
            const misconceptions = [];
            
            rolesData.forEach(role => {
                if (role.primary_responsibilities.includes(responsibility)) {
                    correctRoles.push(role);
                } else if (role.secondary_responsibilities.includes(responsibility)) {
                    partialRoles.push(role);
                }
            });
            
            // Find common misconceptions (roles often incorrectly assigned)
            const assignedRoles = roleAssignments[responsibility] || [];
            assignedRoles.forEach(roleName => {
                const role = rolesData.find(r => r.role === roleName);
                if (!correctRoles.includes(role) && !partialRoles.includes(role)) {
                    misconceptions.push(role);
                }
            });
            
            let content = `<div class="explanation-title">${responsibility}</div>`;
            
            if (correctRoles.length > 0) {
                content += `<div class="explanation-correct"><strong>‚úÖ Correct:</strong> `;
                content += correctRoles.map(r => r.role).join(', ');
                content += `</div>`;
                content += `<div class="explanation-text">${correctRoles[0].description}</div>`;
            }
            
            if (partialRoles.length > 0 && gameMode === "learning") {
                content += `<div class="explanation-text"><strong>‚ö†Ô∏è Also involved:</strong> `;
                content += partialRoles.map(r => r.role).join(', ');
                content += `</div>`;
            }
            
            if (misconceptions.length > 0) {
                content += `<div class="explanation-misconception"><strong>‚ùå Common misconception:</strong> `;
                content += misconceptions.map(r => r.role).join(', ');
                content += ` ${misconceptions[0].role === "Prime Minister" ? "does not directly handle this responsibility." : "is not primarily responsible for this."}`;
                content += `</div>`;
            }
            
            document.getElementById('explanationContent').innerHTML = content;
            document.getElementById('explanationModal').classList.add('show');
        }

        function showRoleExplanation(roleName, responsibility) {
            const role = rolesData.find(r => r.role === roleName);
            let content = `<div class="explanation-title">${roleName}</div>`;
            content += `<div class="explanation-text">${role.description}</div>`;
            content += `<div class="explanation-misconception"><strong>This role is not primarily responsible for:</strong> ${responsibility}</div>`;
            content += `<div class="explanation-text"><strong>Primary responsibilities include:</strong> ${role.primary_responsibilities.slice(0, 3).join(', ')}</div>`;
            
            document.getElementById('explanationContent').innerHTML = content;
            document.getElementById('explanationModal').classList.add('show');
        }

        function closeExplanation(event) {
            if (event && event.target !== event.currentTarget) return;
            document.getElementById('explanationModal').classList.remove('show');
        }

        function resetGame() {
            roleAssignments = {};
            answersChecked = false;
            renderGame();
            document.getElementById('scoreSection').classList.remove('show');
            document.getElementById('checkBtn').style.display = 'block';
            document.getElementById('checkBtn').textContent = 'Check Answers';
            document.getElementById('newRoundBtn').style.display = 'none';
        }

        // Mode toggle
        document.querySelectorAll('.mode-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                gameMode = this.dataset.mode;
            });
        });

        // Close modal on Escape
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeExplanation();
            }
        });

        // Initialize
        newRound();
    </script>
</body>
</html>
